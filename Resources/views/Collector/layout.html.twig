{% extends 'WebProfilerBundle:Profiler:layout.html.twig' %}

{% block toolbar %}
    {% set icon %}
        {% if collector.hasError %}
            {% set color_code = 'red' %}
        {% elseif collector.hasWarning %}
            {% set color_code = 'yellow' %}
        {% else %}
            {% set color_code = 'green' %}
        {% endif %}
        <img width="26" height="28" alt="Sphinx search" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAcCAYAAAB/E6/TAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QEBFAQQhVw1SAAAAv9JREFUSMftlk+IHFUQxn9f985mE2Pm4Ahxel6IORgQj2bX2yIheHFBCKIXBU1EcxM0kJNCDiuKeMlNQsAEzC3gIaCwCP4hSjwpZqNEMGz1mw1JXGWDrJk/XTl0z+ygiJsRL7J16df93ldfvarv1WvYtE2rTBtZFEJWA/a7sw94TKJRYa8B3wJfm8XzYxGFkM2AHwXNuNMCH0Ik+tVL6l5+l8CdH0DnJN4wi/2/JQohe9bdn5Y0B9RG59wLvHfbcQdcrDODElAipZNIQ5dfAq+YxUsACiH7CNjr7nsl4e6MPksSJ9my/Zsdjxx8dNvufarVd6F0CpItFJ0V1q5e5I/2RV+9dF5JbSujuwQtmMUDarWykxKHwN1dkiiAxN27ks4AZ83iwux7K0/0fl362Iue44UGAUgJJClKJujdWv5k6YO5brqt8aQkL+eRWVtJnsfDwPUyjQ6QAKfyvD1pFg+ZxQWAzo0radHr4EWhKmde7rzA+12K7hrpPfd/v7zSmZM0u+6ztKSK7AHgdjV24MUQstNV3VSl4bMyFV4MIqrWIgkBXvROAZjFz83iTon3qyyWRHneLszaU5J+VlmYPvBcCNl14D6AC/MzvwNHBYlDd0QnvUpW576an16sgktLwvbLkvYPiQBarWZiFvcAZ4G0irgB3Gi1mq+XZNPvUtv6Ku6TZVokpAmc0xfmZw4OfJnFfgjZgRCyB83ip3+Rd6vVTPK8XZRniC/cqUkU7iQSv4E+XIv52zcLlh4/0XkonaolLx3mp2ekXoWfBb0mMVe5bJjFX/6xM4SQHXPnLfCBVEdlfwV0E7zv7ruBVunOkfSmWTw+Tgs6AhxzZxdDxaGy0MNz+52kE2bx5Ni9bp2wuR30DnCEskXInTOSXvhzy/lXRGUdsp0Sy+4gcdksPrwRXHK3RHker7lzuUrZjxvFJWPdLeL5avjURjHp3ZKEkMkstuv1HQ13n67X711cXb21+J/cloO2FEK2J4RmYyOYiXGIzOJA01dBvvmj8v+wO7c6V60pF5IvAAAAAElFTkSuQmCC"/>
        <span class="sf-toolbar-status sf-toolbar-status-{{ color_code }}">{{ collector.queryCount }}</span>
    {% endset %}
    {% set text %}
        <div class="sf-toolbar-info-piece">
            <b>Queries</b>
            <span>{{ collector.queryCount }}</span>
        </div>
        <div class="sf-toolbar-info-piece">
            <b>Query time</b>
            <span>{{ '%0.2f'|format(collector.executionTime * 1000) }} ms</span>
        </div>
    {% endset %}
    {% include 'WebProfilerBundle:Profiler:toolbar_item.html.twig' with { 'link': profiler_url } %}
{% endblock %}

{% block menu %}
<span class="label">
    <span class="icon"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABoAAAAcCAYAAAB/E6/TAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3QEBFAQQhVw1SAAAAv9JREFUSMftlk+IHFUQxn9f985mE2Pm4Ahxel6IORgQj2bX2yIheHFBCKIXBU1EcxM0kJNCDiuKeMlNQsAEzC3gIaCwCP4hSjwpZqNEMGz1mw1JXGWDrJk/XTl0z+ygiJsRL7J16df93ldfvarv1WvYtE2rTBtZFEJWA/a7sw94TKJRYa8B3wJfm8XzYxGFkM2AHwXNuNMCH0Ik+tVL6l5+l8CdH0DnJN4wi/2/JQohe9bdn5Y0B9RG59wLvHfbcQdcrDODElAipZNIQ5dfAq+YxUsACiH7CNjr7nsl4e6MPksSJ9my/Zsdjxx8dNvufarVd6F0CpItFJ0V1q5e5I/2RV+9dF5JbSujuwQtmMUDarWykxKHwN1dkiiAxN27ks4AZ83iwux7K0/0fl362Iue44UGAUgJJClKJujdWv5k6YO5brqt8aQkL+eRWVtJnsfDwPUyjQ6QAKfyvD1pFg+ZxQWAzo0radHr4EWhKmde7rzA+12K7hrpPfd/v7zSmZM0u+6ztKSK7AHgdjV24MUQstNV3VSl4bMyFV4MIqrWIgkBXvROAZjFz83iTon3qyyWRHneLszaU5J+VlmYPvBcCNl14D6AC/MzvwNHBYlDd0QnvUpW576an16sgktLwvbLkvYPiQBarWZiFvcAZ4G0irgB3Gi1mq+XZNPvUtv6Ku6TZVokpAmc0xfmZw4OfJnFfgjZgRCyB83ip3+Rd6vVTPK8XZRniC/cqUkU7iQSv4E+XIv52zcLlh4/0XkonaolLx3mp2ekXoWfBb0mMVe5bJjFX/6xM4SQHXPnLfCBVEdlfwV0E7zv7ruBVunOkfSmWTw+Tgs6AhxzZxdDxaGy0MNz+52kE2bx5Ni9bp2wuR30DnCEskXInTOSXvhzy/lXRGUdsp0Sy+4gcdksPrwRXHK3RHker7lzuUrZjxvFJWPdLeL5avjURjHp3ZKEkMkstuv1HQ13n67X711cXb21+J/cloO2FEK2J4RmYyOYiXGIzOJA01dBvvmj8v+wO7c6V60pF5IvAAAAAElFTkSuQmCC" alt="Sphinx search" /></span>
    <strong>Sphinx search</strong>
</span>
{% endblock %}

{% block panel %}
    {{ block('sphinx_queries') }}
    {{ block('sphinx_api_error') }}
    {{ block('sphinx_api_warning') }}
    {{ block('sphinx_status') }}
{% endblock %}

{% block sphinx_api_error %}
    <h2>Api Error</h2>

    <p>
        {% if collector.apiError|length %}
            {{ collector.apiError }}
        {% else %}
            <em>No error</em>
        {% endif %}
    </p>
{% endblock %}

{% block sphinx_api_warning %}
    <h2>Api Warning</h2>

    <p>
        {% if collector.apiWarning|length %}
            {{ collector.apiWarning }}
        {% else %}
            <em>No warning</em>
        {% endif %}
    </p>
{% endblock %}

{% block sphinx_status %}
<h2>Status</h2>
<table>
    <tr>
        <th>Uptime</th>
        <td>{{ collector.status.uptime }}</td>
    </tr>
    <tr>
        <th>Connections</th>
        <td>{{ collector.status.connections }}</td>
    </tr>
    <tr>
        <th>Maxed Out</th>
        <td>{{ collector.status.maxedOut }}</td>
    </tr>
    <tr>
        <th>Command search</th>
        <td>{{ collector.status.commandSearch }}</td>
    </tr>
    <tr>
        <th>Command excerpt</th>
        <td>{{ collector.status.commandExcerpt }}</td>
    </tr>
    <tr>
        <th>Command update</th>
        <td>{{ collector.status.commandUpdate }}</td>
    </tr>
    <tr>
        <th>Command keywords</th>
        <td>{{ collector.status.commandKeywords }}</td>
    </tr>
    <tr>
        <th>Command persist</th>
        <td>{{ collector.status.commandPersist }}</td>
    </tr>
    <tr>
        <th>Command status</th>
        <td>{{ collector.status.commandStatus }}</td>
    </tr>
    <tr>
        <th>Command flush attributes</th>
        <td>{{ collector.status.commandFlushAttributes }}</td>
    </tr>
    <tr>
        <th>Agent connect</th>
        <td>{{ collector.status.agentConnect }}</td>
    </tr>
    <tr>
        <th>Agent retry</th>
        <td>{{ collector.status.agentRetry }}</td>
    </tr>
    <tr>
        <th>Queries</th>
        <td>{{ collector.status.queries }}</td>
    </tr>
    <tr>
        <th>Dist queries</th>
        <td>{{ collector.status.distQueries }}</td>
    </tr>
    <tr>
        <th>Query wall</th>
        <td>{{ collector.status.queryWall }}</td>
    </tr>
    <tr>
        <th>Query CPU</th>
        <td>{{ (collector.status.queryCpu is sameas(false)) ? 'OFF' : collector.status.queryCpu }}</td>
    </tr>
    <tr>
        <th>Dist wall</th>
        <td>{{ collector.status.distWall }}</td>
    </tr>
    <tr>
        <th>Dist local</th>
        <td>{{ collector.status.distLocal }}</td>
    </tr>
    <tr>
        <th>Dist wait</th>
        <td>{{ collector.status.distWait }}</td>
    </tr>
    <tr>
        <th>Query reads</th>
        <td>{{ (collector.status.queryReads is sameas(false)) ? 'OFF' : collector.status.queryReads }}</td>
    </tr>
    <tr>
        <th>Query read kb</th>
        <td>{{ (collector.status.queryReadKb is sameas(false)) ? 'OFF' : collector.status.queryReadKb }}</td>
    </tr>
    <tr>
        <th>Query read time</th>
        <td>{{ (collector.status.queryReadTime is sameas(false)) ? 'OFF' : collector.status.queryReadTime }}</td>
    </tr>
    <tr>
        <th>Average query wall</th>
        <td>{{ collector.status.averageQueryWall }}</td>
    </tr>
    <tr>
        <th>Average query CPU</th>
        <td>{{ (collector.status.averageQueryCpu is sameas(false)) ? 'OFF' : collector.status.averageQueryCpu }}</td>
    </tr>
    <tr>
        <th>Average dist wall</th>
        <td>{{ collector.status.averageDistWall }}</td>
    </tr>
    <tr>
        <th>Average dist local</th>
        <td>{{ collector.status.averageDistLocal }}</td>
    </tr>
    <tr>
        <th>Average dist wait</th>
        <td>{{ collector.status.averageDistWait }}</td>
    </tr>
    <tr>
        <th>Average query reads</th>
        <td>{{ (collector.status.averageQueryReads is sameas(false)) ? 'OFF' : collector.status.averageQueryReads }}</td>
    </tr>
    <tr>
        <th>Average query read kb</th>
        <td>{{ (collector.status.averageQueryReadKb is sameas(false)) ? 'OFF' : collector.status.averageQueryReadKb }}</td>
    </tr>
    <tr>
        <th>Average query read time</th>
        <td>{{ (collector.status.averageQueryReadTime is sameas(false)) ? 'OFF' : collector.status.averageQueryReadTime }}</td>
    </tr>
</table>
{% endblock %}

{% block sphinx_queries %}
<h2>Queries</h2>
<table>
    <tr>
        <th>SphinxQL</th>
        <th>Execution time</th>
    </tr>
    {% for query in collector.queries %}
        <tr>
            <td>
                {{ query.ql }}

                {% if query.error|length or query.warning|length %}
                    <ul class="alt" style="margin-bottom: 5px;">
                        {% if query.error|length %}
                            <li class="error">{{ query.error }}</li>
                        {% endif %}
                        {% if query.warning|length %}
                            <li class="warning">{{ query.warning }}</li>
                        {% endif %}
                    </ul>
                {% endif %}
            </td>
            <td>
                {% if query.executionTime is not sameas(false) %}
                    {{ '%0.2f'|format(query.executionTime * 1000) }} ms
                {% else %}
                    &mdash;
                {% endif %}
            </td>
        </tr>
    {% endfor %}
</table>
{% endblock %}